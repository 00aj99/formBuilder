/*
formBuilder - git@github.com:kevinchappell/formBuilder.git
Version: 1.1.0
Author: Kevin Chappell <kevin.b.chappell@gmail.com>
*/
!function(e){"use strict";var t=function(t,l){ZeroClipboard=window.ZeroClipboard;var a,s,i={disableFields:{before:"",after:""},roles:{1:"Administrator"},showWarning:!1,serializePrefix:"frmb",messages:{add:"Add Item",allowSelect:"Allow Select",autocomplete:"Autocomplete",cannotBeEmpty:"This field cannot be empty",checkboxGroup:"Checkbox Group",checkbox:"Checkbox",checkboxes:"Checkboxes",clearAllMessage:"Are you sure you want to remove all items?",clearAll:"Clear All",close:"Close",copy:"Copy To Clipboard",dateField:"Date Field",description:"Help Text",descriptionField:"Description",devMode:"Developer Mode",disableFields:"These fields cannot be moved.",editNames:"Edit Names",editorTitle:"Form Elements",editXML:"Edit XML",fieldVars:"Field Variables",fieldRemoveWarning:"Ideas have already been submitted to this community. If you remove this field you will no longer be able to use it for idea submission. The data will still be available for reporting. Are you sure you want to proceed?",hide:"Edit",label:"Label",labelEmpty:"Field Label cannot be empty",limitRole:"Limit access to one or more of the following roles:",mandatory:"Mandatory",maxLength:"Max Length",minOptionMessage:"This field requires a minimum of 2 options",name:"Name",no:"No",off:"Off",on:"On",optional:"optional",optionPlaceholder:"Value",optionEmpty:"Option value required",paragraph:"Paragraph",preview:"Preview",radioGroup:"Radio Group",radio:"Radio",removeMessage:"Remove Element",remove:"&#215;",required:"Required",richText:"Rich Text Editor",roles:"Access",save:"Save Template",selectOptions:"Select Items",select:"Select",selectionsMessage:"Allow Multiple Selections",text:"Text Field",warning:"Warning!",viewVars:"View Field Variables",viewXML:"View XML",yes:"Yes"}},n={startMoving:function(t,l){l.item.addClass("moving"),a=e("li",this).index(l.item)},stopMoving:function(t,l){l.item.removeClass("moving"),s&&(e(l.sender).sortable("cancel"),e(this).sortable("cancel"))},safename:function(e){return e.replace(/\s/g,"-").replace(/[^a-zA-Z0-9\-]/g,"").toLowerCase()},isNan:function(e){return e.replace(/[^0-9]/g,"")},initTooltip:function(e){var t=e.find(".tooltip");e.mouseenter(function(){t.outerWidth()>200&&t.addClass("max-width"),t.css("left",e.width()+14),t.stop(!0,!0).fadeIn("fast")}).mouseleave(function(){e.find(".tooltip").stop(!0,!0).fadeOut("fast")}),t.hide()},save:function(){e(D).children("li").not(".disabled").each(function(){n.saveOptions(e(this))}),r.val(e(D).toXML())},saveOptions:function(t){if(!t.hasClass("10"))return!1;var l="";e(".sortable-options li",t).each(function(){var t=e(".select-option",e(this))[0].outerHTML,a=e(".option",e(this)).val();l+=t+" "+a+"<br/>"}),e(".prev-holder",t).html(l)},updateMultipleSelect:function(){e("#"+d).delegate('input[name="multiple"]',"change",function(){var t=e(this).parents(".fields:eq(0)").find(".sortable-options input.select-option");this.checked?t.each(function(){e(this).prop("type","checkbox")}):t.each(function(){e(this).removeAttr("checked").prop("type","radio")})})},htmlEncode:function(t){return e("<div/>").text(t).html()},htmlDecode:function(t){return e("<div/>").html(t).text()},validateForm:function(){var t=[];e('input[name="label"], input[type="text"].option',"#"+d).each(function(){if(""===e(this).val()){var l=e(this).parents("li.form-field"),a=e(this);t.push({field:l,error:o.messages.labelEmpty,attribute:a})}}),t.length&&(alert("Error: "+t[0].error),e("html, body").animate({scrollTop:t[0].field.offset().top},1e3,function(){var l=e(".toggle-form",t[0].field).attr("id");e(".toggle-form",t[0].field).addClass("open").parent().next(".prev-holder").slideUp(250),e("#"+l+"-fld").slideDown(250,function(){t[0].attribute.addClass("error")})}))},disabledTT:function(t){var l=t.attr("data-tooltip");if(l){t.removeAttr("title").data("tip_text",l);var a=e("<p/>",{"class":"frmb-tt"}).html(l);t.append(a),a.css({top:-a.outerHeight(),left:-15}),t.mouseleave(function(){e(this).attr("data-tooltip",t.data("tip_text")),e(".frmb-tt").remove()})}}},o=e.extend(i,l),r=e(t),d="frmb-"+e("ul[id^=frmb-]").length++,c="",p=1,m=d+"-control-box",f=[{type:11,"class":"text-input",label:o.messages.text},{type:6,"class":"select",label:o.messages.select},{type:7,"class":"rich-text",label:o.messages.richText},{type:5,"class":"checkbox",label:o.messages.checkbox},{type:10,"class":"checkbox-group",label:o.messages.checkboxGroup},{type:10,"class":"radio-group",label:o.messages.radioGroup},{type:3,"class":"date_input",label:o.messages.dateField},{type:9,"class":"autocomplete",label:o.messages.autocomplete}],u=1;for(var h in o.disableFields)o.disableFields.hasOwnProperty(h)&&void 0!==o.disableFields[h]&&(o.disableFields[h]='<li class="disabled clearfix disabled_'+u+'">'+o.disableFields[h]+"</li>");for(var v=e("<ul/>",{id:m,"class":"frmb-control"}),g=f.length-1;g>=0;g--){var b='<span class="'+f[g]["class"]+'"></span>';e("<li/>",{type:f[g].type,name:f[g]["class"],multiple:f[g].multiple,label:f[g].label}).html(b+f[g].label).appendTo(v)}var x=e("<h4/>").html(o.messages.editorTitle),y=e("<h4/>").html(o.messages.preview),w=e("<a/>",{id:d+"-export-xml",text:o.messages.viewXML,href:"#","class":"view-xml"}),k=e("<a/>",{id:d+"-allow-select",text:o.messages.allowSelect,href:"#","class":"allow-select"}),C=e("<a/>",{id:d+"-edit-xml",text:o.messages.editXML,href:"#","class":"edit-xml"}),_=e("<a/>",{id:d+"-edit-names",text:o.messages.editNames,href:"#","class":"edit-names"}),T=e("<a/>",{id:d+"-clear-all",text:o.messages.clearAll,href:"#","class":"clear-all"}),M=e("<div/>",{id:d+"-save",href:"#","class":"save-btn-wrap",title:o.messages.save}).html('<a class="save fb-button corner-all-3 primary"><span>'+o.messages.save+"</span></a>"),q=e("<a/>",{id:d+"-view-vars",href:"#","class":"view-vars",title:o.messages.viewVars}).html(o.messages.viewVars),F=e("<div/>",{id:d+"-action-links-inner","class":"action-links-inner"}).append(C," | ",q," | ",_," | ",k," | ",T," |&nbsp;"),E=e("<span/>",{"class":"dev-mode-link"}).html(o.messages.devMode+" "+o.messages.off),L=e("<div/>",{id:d+"-action-links","class":"action-links"}).append(F,E),D=e("<ul/>").attr("id",d).addClass("frmb").sortable({cursor:"move",opacity:.9,beforeStop:function(t,l){var a=e("> li",D).length-1,i=l.placeholder.index();s=1>=i||i===a},start:n.startMoving,stop:n.stopMoving,cancel:"input, .disabled, .sortable-options",receive:function(e,t){},placeholder:"frmb-placeholder"});v.sortable({helper:"clone",opacity:.9,connectWith:D,cursor:"move",placeholder:"ui-state-highlight",start:n.startMoving,stop:n.stopMoving,revert:150,change:function(t,l){0===l.placeholder.index()||l.placeholder.index()===e("> li",D).last().index()?e(l.placeholder).hide():e(l.placeholder).show()},remove:function(t,l){0===a?v.prepend(l.item):e("li:nth-child("+a+")",v).after(l.item)},beforeStop:function(t,l){var a=e("> li",D).length-1,i=l.placeholder.index();s=1>=i||i===a?!0:!1,l.placeholder.parent().hasClass("frmb-control")&&(s=!0)},update:function(t,l){r.stopIndex=0===e("li",D).index(l.item)?"0":e("li",D).index(l.item),e("li",D).index(l.item)<0?e(this).sortable("cancel"):O(e(l.item[0]),!0)},receive:function(t,l){(l.sender.hasClass("frmb")||l.sender.hasClass("frmb-control"))&&e(l.sender).sortable("cancel")}}),r.before(D).parent().prepend(y).addClass("frmb-wrap").append(L,w,M);var A=e("<div/>",{id:d+"-cb-wrap","class":"cb-wrap"}).append(x,v);e(".frmb-wrap").before(A).append(L),e("ul.frmb input").on("change",function(){0===e(this).parents("li.disabled").length&&n.save()}),e("ul.frmb input").on("blur",function(){0===e(this).parents("li.disabled").length&&n.save()}),e('input[name="label"]',"#"+d).on("blur",function(){""===e(this).val()&&alert("Error: "+o.messages.labelEmpty)}),r.getTemplate=function(){var t=""!==r.val()?e.parseXML(r.val()):"",l=e(t).find("field");if(l.length>0)O(l);else if(""===t){var a={label:o.messages.descriptionField,name:"content",required:"true",description:o.messages.mandatory,type:"7"};S(a),D.prepend(o.disableFields.before),D.append(o.disableFields.after)}else D.prepend(o.disableFields.before),D.append(o.disableFields.after)};var I=function(e){var t=(new Date).getTime();return e.attr("name")+"-"+t},O=function(t,l){l=l||!1,t.each(function(){var t=e(this).attr("type"),a=[];a.label=n.htmlEncode(e(this).attr("label")),a.name=l?I(e(this)):e(this).attr("name"),a.role=e(this).attr("role"),a.required=e(this).attr("required"),a.maxLength=e(this).attr("max-length"),a.type=t,a.description=void 0!==e(this).attr("description")?n.htmlEncode(e(this).attr("description")):"",5===t?e(this).children().each(function(){a.push([e(this).text(),this.baseline])}):("6"===t||"10"===t)&&(a.multiple=e(this).hasClass("checkbox-group")?!0:"multiple"===e(this).attr("style")?!0:!1,a.values=[],6!==parseInt(t)||l||0!==e(this).children().length?e(this).children().each(function(t){a.values.push({value:e(this).text(),selected:e(this).attr("default")===t?!0:!1})}):a.type="11"),S(a)}),e("li.disabled",D).length<2&&(D.prepend(o.disableFields.before),D.append(o.disableFields.after))},S=function(t){void 0===t&&(t="");var l=function(e){V(o.messages.text,B(e),e)},a=function(e){V(o.messages.richText,B(e),e)},s=function(e){V(o.messages.checkbox,B(e),e)},i=function(t){t.values&&0===t.values.length?t.values=[{selected:"false",value:"Option 1"},{selected:"false",value:"Option 2"}]:t.values=[];var l="",a=n.safename(t.name),s=("10"===t.type,"none");for(l+=B(t),l+='<div class="false-label">'+o.messages.selectOptions+"</div>",l+='<div class="fields">',l+='<div class="allow-multi" style="display:'+s+'">',l+='<input type="checkbox" id="multiple_'+p+'" name="multiple"'+(t.multiple?'checked="checked"':"")+">",l+='<label class="multiple" for="multiple_'+p+'">'+o.messages.selectionsMessage+"</label>",l+="</div>",l+='<ol class="sortable-options">',g=0;g<t.values.length;g++)l+=R(t.values[g].value,a,t.values[g].selected,t.multiple);l+="</ol>",l+='<div class="field_actions"><a href="#" class="add add_opt"><strong>'+o.messages.add+'</strong></a> | <a href="#" class="close_field">'+o.messages.close+"</a></div>",l+="</div>",V(o.messages.select,l,t),e(".sortable-options").sortable({})},r={2:l,3:l,9:l,5:s,6:i,7:a,8:i,10:i,11:l};r[t.type](t)},B=function(t){var l,a="",s=void 0!==t.role?t.role.split(","):[],i=e("<div>",{"class":"frm-fld"});e("<label/>").html(o.messages.label+" *").appendTo(i),e("<input>",{type:"text",name:"label",value:t.label,"class":"fld-label"}).appendTo(i),a+=i[0].outerHTML;var n=e("<div>",{"class":"frm-fld description-wrap"});e("<label/>").html(o.messages.description+" *").appendTo(n),a+='<div class="frm-fld description-wrap"><label>'+o.messages.description+"</label>",a+='<input type="text" name="description" value="'+t.description+'" class="fld-description" id="description-'+p+'" /></div>',a+='<div class="frm-fld name_wrap"><label>'+o.messages.name+' <span class="required">*</span></label>',a+='<input type="text" name="name" value="'+t.name+'" class="fld-name" id="title-'+p+'" /></div>',a+='<div class="frm-fld"><label>'+o.messages.roles+"</label>",a+='<input type="checkbox" name="enable_roles" value="" '+(void 0!==t.role?"checked":"")+' id="enable_roles-'+p+'"/> <label for="enable_roles-'+p+'" class="roles_label">'+o.messages.limitRole+"</label>",a+='<div class="frm-fld available-roles" '+(void 0!==t.role?'style="display:block"':"")+">";for(l in o.roles)-1===e.inArray(l,["3","4"])&&(a+='<input type="checkbox" name="roles[]" value="'+l+'" id="fld-'+p+"-roles-"+l+'" '+(-1!==e.inArray(l,s)?"checked":"")+' class="roles-field" /><label for="fld-'+p+"-roles-"+l+'">'+o.roles[l]+"</label><br/>");return a+="</div></div>",e.inArray(t.type,["5","6","10","3","9"])<0&&(a+='<div class="frm-fld"><label class="max-length-label">'+o.messages.maxLength+"</label>",a+='<input type="text" name="max-length" max-length="4" value="'+(void 0!==t.maxLength?t.maxLength:"")+'" class="fld-max-length" id="max-length-'+p+'" /></div>'),a},V=function(t,l,a){var s=""!==e(l).find('input[name="label"]').val()?e(l).find('input[name="label"]').val():t,i="",d='<a id="del_'+p+'" class="del-button btn delete-confirm" href="#" title="'+o.messages.removeMessage+'">'+o.messages.remove+"</a>",c='<a id="frm-'+p+'" class="toggle-form btn" href="#">'+o.messages.hide+"</a> ",m=a.required,f=""!==a.description?'<span class="element-info corner-all-3 tooltip-element">?<span class="tooltip tooltip-left-side corner-all-3" aria-required="true">'+a.description+'<span class="indicator top-side"></span></span></span>':"";i+='<li id="frm-'+p+'-item" class="'+a.type+' form-field">',i+='<div class="legend">',i+=d,i+='<span id="txt-title-'+p+'" class="field_label">'+s+"</span>"+f+'<span class="required-asterisk" '+("true"===m?'style="display:inline"':"")+"> *</span>"+c+"</div>",i+='<div class="prev-holder type_'+a.type+'"></div>',i+='<div id="frm-'+p+'-fld" class="frm-holder">',i+='<div class="frm-elements">',i+='<div class="frm-fld">',i+="<label>&nbsp;</label>",i+='<input class="required" type="checkbox" value="1" name="required-'+p+'" id="required-'+p+'"'+("true"===m?' checked="checked"':"")+' /><label class="required_label" for="required-'+p+'">'+o.messages.required+"</label>",i+="</div>",i+=l,i+="</div>",i+="</div>",i+="</li>",r.stopIndex?e("li",D).eq(r.stopIndex).after(i):(e(D).append(i),n.initTooltip(e("#frm-"+p+"-item").find(".tooltip-element"))),e("#frm-"+p+"-item").hide().slideDown(250),p++,n.save()},R=function(e,t,l,a){var s=a?"checkbox":"radio";return c="<li>",c+='<input type="'+s+'" '+l+' class="select-option" name="'+t+'" />',c+='<input type="text" class="option" placeholder="'+o.messages.optionPlaceholder+'" value="'+e+'" />',c+='<a href="#" class="remove btn" title="'+o.messages.removeMessage+'">'+o.messages.remove+"</a>",c+="</li>"};e("#"+d).delegate(".remove","click",function(t){t.preventDefault();var l=e(this).parents(".sortable-options:eq(0)").children("li").length;2>=l?alert("Error: "+o.messages.minOptionMessage):e(this).parent("li").slideUp("250",function(){e(this).remove()})}),e("#"+d).delegate(".toggle-form","click",function(t){t.preventDefault();var l=e(this).attr("id");e(this).toggleClass("open").parent().next(".prev-holder").slideToggle(250,n.saveOptions(e(this).parents("li:eq(0)"))),e("#"+l+"-fld").slideToggle(250,function(){})}),e("#"+d).delegate('input[name="label"]',"keyup",function(){e(".field_label",e(this).closest("li")).text(e(this).val())}),e("#"+d).delegate("input.error","keyup",function(){e(this).removeClass("error")}),e("#"+d).delegate('input[name="description"]',"keyup",function(){var t=e(".legend .tooltip",e(this).closest("li"));if(""!==e(this).val())if(t.length)t.text(e(this).val()).append('<span class="indicator top-side"></span>'),e(".legend .tooltip-element",e(this).closest("li")).show();else{var l=e('<span class="element-info corner-all-3 tooltip-element">?<span class="tooltip tooltip-left-side corner-all-3" aria-required="true">'+e(this).val()+'<span class="indicator top-side"></span></span></span>');e(".toggle-form",e(this).closest("li")).before(l),n.initTooltip(l)}else t.length&&e(".legend .tooltip-element",e(this).closest("li")).hide()}),n.updateMultipleSelect(),e("#"+d).delegate('input[name="name"]',"keyup",function(){e(this).val(n.safename(e(this).val())),""===e(this).val()?e(this).addClass("field_error").attr("placeholder",o.messages.cannotBeEmpty):e(this).removeClass("field_error")}),e("#"+d).delegate("input.fld-max-length","keyup",function(){e(this).val(n.isNan(e(this).val()))}),e("#"+d).delegate(".delete-confirm","click",function(t){t.preventDefault();var l=e("<h3/>").html("<span></span>"+o.messages.warning),a=e(this).attr("id").replace(/del_/,""),s=e(this),i=s.offset().left-e(window).scrollLeft(),r=s.offset().top-e(window).scrollTop();o.showWarning?jQuery("<div />").append(l,o.messages.fieldRemoveWarning).dialog({modal:!0,resizable:!1,width:300,dialogClass:"ite-warning",open:function(){e(".ui-widget-overlay").css({opacity:0})},position:[i-282,r-178],buttons:[{text:o.messages.yes,click:function(){e("#frm-"+a+"-item").slideUp(250,function(){e(this).remove(),n.save()}),e(this).dialog("close")}},{text:o.messages.no,"class":"cancel",click:function(){e(this).dialog("close")}}]}):e("#frm-"+a+"-item").slideUp(250,function(){e(this).remove(),n.save()})}),e("#"+d).delegate("input.required","click",function(){var t=e(this).parents("li.form-field").find(".required-asterisk");t.toggle()}),e("#"+d).delegate('input[name="enable_roles"]',"click",function(){var t=e(this).siblings("div.available-roles"),l=e(this);t.slideToggle(250,function(){l.is(":checked")||e('input[type="checkbox"]',t).removeAttr("checked")})}),e("#"+d).delegate(".add_ck","click",function(){return e(this).parent().before(R()),!1}),e("#"+d).delegate("li.disabled .form-element","mouseenter",function(){n.disabledTT(e(this))}),e("#"+d).delegate(".add_opt","click",function(t){t.preventDefault();var l=e(this).parents(".fields").first().find('input[name="multiple"]')[0].checked,a=e(this).parents(".fields").find(".select-option:eq(0)").attr("name");e(this).parents(".fields").first().find(".sortable-options").append(R("",a,!1,l)),n.updateMultipleSelect()}),e("#"+d).delegate(".close_field","click",function(t){t.preventDefault(),e(this).parents("li.form-field").find(".toggle-form").trigger("click")}),e("#"+d).delegate(".add_rd","click",function(t){t.preventDefault(),e(this).parent().before(R(!1,e(this).parents(".frm-holder").attr("id")))}),e(".frm-elements .fields .remove, .frmb .del-button").on("hover",function(){e(this).parents("li.form-field").toggleClass("delete")}),e("#"+d+"-export-xml").click(function(t){t.preventDefault();var l=r.val(),a=e("<pre />").text(l);a.dialog({resizable:!1,modal:!0,width:720,dialogClass:"frmb-xml",overlay:{color:"#333333"}})}),e(document.getElementById(d+"-view-vars")).click(function(t){t.preventDefault();var l='<table width="100%">';l+='<tr><td width="50%" height="30"><strong>'+o.messages.fieldVars+'</strong></td><td align="center"><strong>'+o.messages.copy+"</strong></td></tr>",e(D).children("li").not(".disabled").each(function(){l+="<tr><td>$__"+e('input[name="name"]',e(this)).val()+'__</td><td align="center"><span id='+e('input[name="name"]',e(this)).val()+"_"+Math.random().toString(36).substr(2,6)+'_var" class="copy_var clipboard" data-clipboard-text="$__'+e('input[name="name"]',e(this)).val()+'__"></span></td></tr>'}),l+="</table>",e("<div />").html(l).dialog({modal:!0,width:400,dialogClass:"spigit-field-vars",overlay:{color:"#333333"},open:function(){e(".copy_var").each(function(){var t=e(this).attr("id"),l=new ZeroClipboard(document.getElementById(t),{moviePath:"/js/speui/ideatemplate/js/zeroclipboard/ZeroClipboard.swf"});l.on("load",function(t){t.on("complete",function(t,l){e(".copy_var").removeClass("copied"),e(this).addClass("copied")})})})}})}),e("#"+d+"-clear-all").click(function(t){if(t.preventDefault(),confirm(o.messages.clearAllMessage)){e(D).empty(),r.val(""),n.save();var l={label:[o.messages.descriptionField],name:["content"],required:"true",description:o.messages.mandatory};S(l),D.prepend(o.disableFields.before),D.append(o.disableFields.after)}}),e("#"+d+"-save").click(function(t){0===e(this).find(".ldkInlineEdit").length&&(t.preventDefault(),D.parent(".frmb-wrap").hasClass("edit-xml")||n.save(),n.validateForm(t))});var X=!1,N=[],P="68,69,86";e(".save.fb-button").mouseover(function(){X=!0}).mouseout(function(){X=!1}),e(document.documentElement).keydown(function(t){N.push(t.keyCode),N.toString().indexOf(P)>=0&&(e(".action-links").toggle(),e(".view-xml").toggle(),console.log("developer mode activated"),N=[])}),e(".dev-mode-link").click(function(t){t.preventDefault();var l=e(this),a=D.parent(".frmb-wrap");a.toggleClass("dev-mode"),l.parent().css("opacity",1),a.hasClass("dev-mode")?(l.siblings(".action-links-inner").css("width","100%"),l.html(o.messages.devMode+" "+o.messages.on).css("color","#8CC63F")):(l.siblings(".action-links-inner").css("width",0),l.html(o.messages.devMode+" "+o.messages.off).css("color","#666666"),X=!1,e(".action-links").toggle(),e(".view-xml").toggle(),console.log("developer mode deactivated"))}),e(document.getElementById(d+"-edit-names")).click(function(t){t.preventDefault();var l=D.parent(".frmb-wrap");e(this).toggleClass("active"),e(".name_wrap",D).slideToggle(250,function(){l.toggleClass("edit-names")})}),e(document.getElementById(d+"-allow-select")).click(function(t){t.preventDefault();var l=D.parent(".frmb-wrap");e(this).toggleClass("active"),e(".allow-multi, .select-option",D).slideToggle(250,function(){l.toggleClass("allow-select")})}),e(document.getElementById(d+"-edit-xml")).click(function(t){t.preventDefault();var l=D.parent(".frmb-wrap");e(this).toggleClass("active"),e("textarea.idea_template").show(),e(".template-textarea-wrap").slideToggle(250),l.toggleClass("edit-xml")}),r.parent().find('p[id*="ideaTemplate"]').remove(),r.wrap('<div class="template-textarea-wrap"/>'),r.getTemplate()};e.fn.formBuilder=function(l){var a=this;return a.each(function(){var a=e(this);if(!a.data("formBuilder")){var s=new t(this,l);a.data("formBuilder",s)}})}}(jQuery),function(e){"use strict";e.fn.toXML=function(t){var l={prepend:"",attributes:["class"]},a=e.extend(l,t),s="";return this.each(function(){var t=0,l=1;e(this).children().length>=1&&(s+="<idea-template>\n	<fields>",e(this).children().each(function(){if(!e(this).hasClass("moving")&&!e(this).hasClass("disabled"))for(var i=0;i<a.attributes.length;i++){var n=e("#"+e(this).attr("id")+" input.required").is(":checked")?'required="true" ':'required="false" ',o=e("#"+e(this).attr("id")+' input[name="multiple"]').is(":checked"),r=o?'style="multiple" ':"",d=e(this).attr(a.attributes[i]),c='type="'+d+'" ',p=e(this).attr("id"),m='name="'+e("#"+p+" input.fld-name").val()+'" ',f='label="'+e("#"+p+" input.fld-label").val()+'" ',u=e.map(e("#"+p+" input.roles-field:checked"),function(e){return e.value}).join(","),h=""!==u?'role="'+u+'" ':"",v='description="'+e("#"+p+" input.fld-description").val()+'" ',g=e("#"+p+" input.fld-max-length").val(),b='max-length="'+(void 0!==g?g:"")+'" ',x="6"!==d&&"10"!==d?"/":"";s+="\n		<field "+m+f+r+h+v+(""!==g&&void 0!==g?b:"")+n+c+x+">",("6"===d||"10"===d)&&(l=1,e("#"+e(this).attr("id")+" input[type=text][class=option]").each(function(){if("title"!==e(this).attr("name")){var t=e(this).prev().is(":checked")?' selected="true"':"";s+="\n			<option"+t+">"+e(this).val()+"</option>"}l++}),s+="\n		</field>")}t++}),s+="\n	</fields>\n</idea-template>")}),s}}(jQuery);